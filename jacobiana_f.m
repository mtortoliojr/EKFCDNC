%%--------------------------------------------------------------------------------
%% Função para o cálculo da jacobiana da função f(x,u)
%%--------------------------------------------------------------------------------
function dF = jacobiana_f(x,u)

% Componentes q e b de x
q = x(1:4); 
b = x(5:7);

% Componentes de u
wp = u;

% Cálculo da matriz Ksi e de sua jacobiana em relação a q
Ksi = matriz_Ksi(q);
dKsi = jacobiana_Ksi(q);

% --------------------------------------------------------------
%  Definição da matriz jacobiana de f em relação a x
%  
%  dF = d(f)/d(x)
%
%  dF =  | df1/dq1 ... df1/dq4 df1/db1 ... df1/db3 |
%		 |    .			 .		 .			 .	   |
%		 |    .			 .		 .			 .	   |
%		 |    .			 .		 .			 .	   |
%		 | df7/dq1 ... df7/dq4 df7/db1 ... df7/db3 |
%     
%	  =  | dF1 |
% 		 | dF2 |
%
% --------------------------------------------------------------
dF = zeros(7,7);

% --------------------------------------------------------------
%  dF1 = | df1/dq1 ... df1/dq4 df1/db1 ... df1/db3 |
%		 |    .			 .		 .			 .	   |
%		 |    .			 .		 .			 .	   |
%		 |    .			 .		 .			 .	   |
%		 | df4/dq1 ... df4/dq4 df4/db1 ... df4/db3 |
%		
%	   = | dF1q1 ... dF1q4 , dF1b|  
% --------------------------------------------------------------
wb = wp - b;

dF1q1 = 0.5 * dKsi(:,1:3) * wb;
dF1q2 = 0.5 * dKsi(:,4:6) * wb;
dF1q3 = 0.5 * dKsi(:,7:9) * wb;
dF1q4 = 0.5 * dKsi(:,10:12) * wb;
dF1b = -0.5 * Ksi;

dF1 = [dF1q1,dF1q2,dF1q3,dF1q4,dF1b];

% --------------------------------------------------------------
%  dF2 = | df5/dq1 ... df5/dq4 df5/db1 ... df5/db3 |
%		 |    .			 .		 .			 .	   |
%		 |    .			 .		 .			 .	   |
%		 |    .			 .		 .			 .	   |
%		 | df7/dq1 ... df7/dq4 df7/db1 ... df7/db3 |
% --------------------------------------------------------------
dF2 = [zeros(3,7)];

% --------------------------------------------------------------
% Jacobiana dF
% --------------------------------------------------------------
dF = [dF1; dF2];

end
